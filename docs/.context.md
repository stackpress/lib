# Stackpress Library

Comprehensive API documentation for the Stackpress Library - a shared library used across Stackpress projects that standardizes type definitions and provides common utilities for developers. This library serves as the foundation for event-driven architecture, data manipulation, routing, and cross-platform file operations.

## 1. Installation and Setup

Getting started with the Stackpress Library is straightforward and requires minimal configuration. The library is designed to work seamlessly across different environments and provides both CommonJS and ES module support.

### 1.1. Package Installation

The following example shows how to install the Stackpress Library using npm.

```bash
npm install @stackpress/lib
```

### 1.2. Basic Usage

The following example shows how to import and use core components from the library.

```typescript
import { 
  EventEmitter, 
  Nest, 
  Router, 
  Exception 
} from '@stackpress/lib';

// Type-safe nested data
type ConfigMap = {
  database: { host: string; port: number };
  cache: { ttl: number };
};
const config = new Nest<ConfigMap>();

// Type-safe event handling
type EventMap = {
  'user-login': [string, Date];
  'data-update': [object];
};
const emitter = new EventEmitter<EventMap>();

// Cross-platform routing
const router = new Router();
```

## 2. Core Components

The Stackpress Library consists of six main component categories that work together to provide a comprehensive development toolkit. Each component is designed with type safety, cross-platform compatibility, and event-driven architecture in mind.

### 2.1. Data Structures

Data structures in programming are specialized formats for organizing, processing, storing, and retrieving data within a computer's memory. The Stackpress Library provides enhanced data structures with type safety and chainable APIs.

**Key Features:**
- Type-safe nested object manipulation
- Path-based data access with dot notation
- Built-in parsers for query strings, form data, and arguments
- Chainable API for fluent data operations

**Components:**
- **Nest** - Hierarchical data management for nested objects and arrays
- **Maps** - Callable Map instances with enhanced functionality
- **Sets** - Callable Set instances with index-based access

### 2.2. Events

Event-driven design to support event chain reactions throughout your application stack. From browser clicks to CLI commands to backend routing, Stackpress treats everything as an event that flows seamlessly through your system.

**Key Features:**
- Priority-based event listeners
- Type-safe event maps with TypeScript generics
- Before/after hooks for event execution
- Task queue management for event handling

**Components:**
- **EventEmitter** - Observer pattern implementation with priority levels
- **ExpressEmitter** - Pattern matching and parameter extraction capabilities
- **RouteEmitter** - HTTP-like route handling with event-driven architecture

### 2.3. Exception Handling

Enhanced error handling with expressive error reporting and stack trace support. Provides better error information than standard JavaScript errors with template-based messages and validation error aggregation.

**Key Features:**
- Template-based error messages
- Validation error aggregation
- Enhanced stack trace parsing
- HTTP status code integration

**Components:**
- **Exception** - Enhanced error class with formatting and validation support
- **Status** - HTTP status code utilities and response management

### 2.4. Queues

Priority-based queue implementations for managing items and tasks with FIFO ordering. Includes both generic item queues and specialized task queues for sequential execution.

**Key Features:**
- Priority-based ordering (higher numbers execute first)
- FIFO ordering within same priority levels
- Task execution with before/after hooks
- Chainable API for queue operations

**Components:**
- **ItemQueue** - Generic priority queue for any item type
- **TaskQueue** - Specialized queue for executing functions sequentially

### 2.5. Routing

Event-driven routing system with generic Request and Response wrappers that work across different platforms (HTTP, terminal, web sockets). Provides a unified interface for handling requests regardless of the underlying transport.

**Key Features:**
- Cross-platform request/response handling
- Parameter extraction from routes
- Event-driven architecture
- Generic type support for different mediums

**Components:**
- **Request** - Generic request wrapper for various platforms
- **Response** - Generic response wrapper with multiple output formats
- **Router** - Event-driven router with Express-like syntax

### 2.6. File System

Cross-platform file loading utilities for locating, loading, and importing files throughout your project and node_modules. Handles path resolution, module discovery, and dynamic imports with consistent APIs.

**Key Features:**
- Cross-platform path resolution
- Node modules discovery
- Dynamic import support
- Project root (@/) path shortcuts

**Components:**
- **FileLoader** - Main file loading and resolution utility
- **NodeFS** - Node.js filesystem implementation

## 3. Type Safety and Browser Compatibility

The Stackpress Library is built with TypeScript and provides comprehensive type definitions to ensure type safety throughout your application. All components support generic types for enhanced compile-time checking and better developer experience.

### 3.1. TypeScript Integration

The following example shows how to use generic types for enhanced type safety.

```typescript
// Type-safe nested data
type ConfigMap = {
  database: { host: string; port: number };
  cache: { ttl: number };
};
const config = new Nest<ConfigMap>();

// Type-safe event handling
type EventMap = {
  'user-login': [string, Date];
  'data-update': [object];
};
const emitter = new EventEmitter<EventMap>();

// Type-safe queue operations
const queue = new TaskQueue<[number, string]>();
```

### 3.2. Browser Compatibility

Most components work in both Node.js and browser environments with consistent APIs and behavior.

| Component | Browser Support | Notes |
|-----------|----------------|-------|
| **Nest** | ‚úÖ Full support | Complete browser compatibility |
| **EventEmitter** | ‚úÖ Full support | Works in all modern browsers |
| **Exception** | ‚úÖ Full support | Enhanced error handling available |
| **Queue** | ‚úÖ Full support | Priority queues work everywhere |
| **Router** | ‚úÖ Full support | Cross-platform routing available |
| **FileLoader/NodeFS** | ‚ö†Ô∏è Node.js only | Server-side file operations |

## 4. Event-Driven Architecture

At its core, all software exists for users to interact with it. These interactions‚Äîwhether a mouse click in the browser, a command in the terminal, or a tap on a mobile app, are all actions. Actions are **events**. The Stackpress Library embraces this fundamental principle by making events the foundation of software design.

### 4.1. Event-Driven Benefits

Modern event-driven systems are valued for being **responsive, loosely coupled, scalable, and resilient**. The Stackpress Library builds on these principles to provide a unified development experience.

- **üîÑ Responsive** ‚Äî React immediately when an event occurs, instead of waiting on rigid request/response cycles. This enables real-time behavior, such as updating a UI the moment data changes or triggering backend workflows instantly.
- **üß© Loosely Coupled** ‚Äî Components don't need direct knowledge of each other; they communicate through events. This reduces dependencies, making systems easier to maintain and extend.
- **üìà Scalable** ‚Äî Events are asynchronous, which means they can be queued, processed in parallel, and distributed across workers or servers. This makes handling high loads far simpler.
- **üõ°Ô∏è Resilient** ‚Äî Failures are isolated. If one listener fails, the rest of the system continues. Recovery strategies like retries or fallbacks can be added without rewriting business logic.

### 4.2. Chain Reaction Events

Stackpress builds on these principles by making events not just a layer, but the **foundation** of software design. A user interaction starts at the edge (browser, CLI, mobile app), but in a fully event-driven design these same events can propagate through the backend‚Äîacross servers, databases, sockets, etc. setting off a chain reaction of events where one event triggers actions, and those actions can emit more events in turn, and so on.

In Stackpress, even a router is a type of event emitter. By treating routes, sockets, and commands as events, Stackpress provides a unified, generically designed emitter that simplifies building across environments.

## 5. Quick Start Examples

The following examples demonstrate common usage patterns and help you get started with the Stackpress Library quickly. Each example builds on the previous ones to show how components work together.

### 5.1. Basic Data Management

The following example shows how to use Nest for hierarchical data management.

```typescript
import { Nest } from '@stackpress/lib';

type AppConfig = {
  database: { host: string; port: number };
  cache: { ttl: number; enabled: boolean };
};

const config = new Nest<AppConfig>({
  database: {
    host: 'localhost',
    port: 5432
  },
  cache: {
    ttl: 3600,
    enabled: true
  }
});

// Access nested data with type safety
const dbHost = config.get('database', 'host'); // string
const cacheEnabled = config.get('cache', 'enabled'); // boolean

// Use path notation for convenience
const dbPort = config.path('database.port'); // number
```

### 5.2. Event-Driven Communication

The following example shows how to set up type-safe event handling with priority levels.

```typescript
import { EventEmitter } from '@stackpress/lib';

type AppEvents = {
  'user-login': [string, Date];
  'user-logout': [string];
  'data-update': [string, object];
};

const emitter = new EventEmitter<AppEvents>();

// Add event listeners with priorities
emitter.on('user-login', async (userId, timestamp) => {
  console.log(`User ${userId} logged in at ${timestamp}`);
}, 1); // Lower priority

emitter.on('user-login', async (userId, timestamp) => {
  // High priority - runs first
  await validateSession(userId);
}, 10); // Higher priority

// Emit events with type safety
await emitter.emit('user-login', 'user123', new Date());
```

### 5.3. Cross-Platform Routing

The following example shows how to create routes that work across different platforms.

```typescript
import { Router } from '@stackpress/lib';

const router = new Router();

// Define routes with parameter extraction
router.route('GET', '/users/:id', async (req, res) => {
  const userId = req.data.get('id');
  const user = await getUserById(userId);
  res.setJSON({ user });
});

router.route('POST', '/users', async (req, res) => {
  const userData = req.data.get();
  const newUser = await createUser(userData);
  res.setJSON(newUser, 201, 'Created');
});

// Resolve routes programmatically
const response = await router.resolve('GET', '/users/123');
console.log(response.results); // User data
```

### 5.4. Error Handling and Validation

The following example shows how to use Exception for enhanced error handling.

```typescript
import { Exception } from '@stackpress/lib';

// Create exceptions with templates
throw Exception.for('User %s not found', userId);

// Handle validation errors
const exception = new Exception('Invalid user data')
  .withCode(400)
  .withErrors({
    email: 'Email is required',
    password: ['Password too short', 'Must contain numbers']
  });

// Convert to response format
const errorResponse = exception.toResponse();
// { code: 400, error: 'Invalid user data', errors: {...} }
```

## 6. Advanced Usage Patterns

For more complex applications, the Stackpress Library provides advanced patterns that combine multiple components for powerful functionality. These patterns demonstrate how to build scalable, maintainable applications.

### 6.1. Plugin Architecture with Events

The following example shows how to create a plugin system using event priorities.

```typescript
import { EventEmitter, TaskQueue } from '@stackpress/lib';

class PluginSystem extends EventEmitter<{
  'process-request': [Request, Response];
  'validate-data': [object];
}> {
  loadPlugin(plugin: Plugin) {
    // Plugins can insert themselves at different priority levels
    plugin.register(this);
  }
}

// Plugin example
class AuthPlugin {
  register(system: PluginSystem) {
    // High priority - runs early
    system.on('process-request', async (req, res) => {
      if (!req.headers.get('authorization')) {
        res.setError('Unauthorized', {}, [], 401);
        return false; // Stop processing
      }
    }, 100);
  }
}
```

### 6.2. Cross-Platform File Operations

The following example shows how to use FileLoader for dynamic module loading.

```typescript
import { FileLoader, NodeFS } from '@stackpress/lib';

const loader = new FileLoader(new NodeFS());

// Load configuration with fallbacks
async function loadConfig() {
  try {
    return await loader.import('@/config.json');
  } catch {
    return await loader.import('@/config.default.json');
  }
}

// Dynamic plugin loading
async function loadPlugins() {
  const pluginDir = await loader.absolute('@/plugins');
  const plugins = [];
  
  for (const file of await fs.readdir(pluginDir)) {
    if (file.endsWith('.js')) {
      const plugin = await loader.import(`@/plugins/${file}`, true);
      plugins.push(plugin);
    }
  }
  
  return plugins;
}
```

## 7. Documentation Reference

For detailed API documentation and comprehensive examples, refer to the individual component documentation files. Each file provides in-depth coverage of specific functionality with practical examples.

### 7.1. Component Documentation

The following documentation files provide detailed API references for each component category.

- **[Data Structures](./Structures.md)** - Nest, Maps, Sets, and data manipulation utilities
- **[Events](./Events.md)** - EventEmitter, ExpressEmitter, RouteEmitter, and event handling
- **[Exception](./Exception.md)** - Exception handling, error formatting, and validation
- **[Queues](./Queues.md)** - ItemQueue, TaskQueue, and priority-based processing
- **[Routing](./Routing.md)** - Request, Response, Router, and cross-platform routing
- **[File System](./Systems.md)** - FileLoader, NodeFS, and file operations
- **[Types](./Types.md)** - TypeScript type definitions and interfaces

### 7.2. Getting Help

For additional support, examples, and community resources, visit the official Stackpress documentation and GitHub repository. The library is actively maintained and welcomes contributions from the community.

**Resources:**
- GitHub Repository: [https://github.com/stackpress/lib](https://github.com/stackpress/lib)
- Issue Tracker: Report bugs and request features
- Community Discussions: Share usage patterns and get help
- Contributing Guide: Learn how to contribute to the project
